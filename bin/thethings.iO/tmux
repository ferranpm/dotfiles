#!/usr/bin/env bash

BASE_PATH="thethings.iO/"
PROJECTS="$*"

usage() {
    echo -e "USAGE:"
    echo -e "\t$1 project [-e] [project...]"
}

if [[ "${#PROJECTS}" == "0" ]]; then
    usage $0
    exit 1
fi

EMPTY=0
while getopts "he" OPTION
do
    case $OPTION in
        h)
            usage $0
            exit 1 ;;
        e) EMPTY=1;;
        ?)
            usage $0
            exit 1 ;;
    esac
done

for PROJECT in ${PROJECTS[*]}; do
    tmux-mksession "$BASE_PATH/${PROJECT}" &
done

if [[ "$EMPTY" -eq "0" ]]; then
    ttio vpn &

    ps -C grunt > /dev/null
    if [[ ! $? == 0 ]]; then
        st -e /usr/bin/sh -c 'cd ~/Workspace/thethings.iO/panel.thethings.io/ && grunt live' &
    fi
fi
